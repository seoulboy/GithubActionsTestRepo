name: Super-Linter

on: pull_request

jobs:
  # Set the job key. The key is displayed as the job name
  # when a job name is not provided
  super-lint:
    # Name the Job
    name: Lint code base
    # Set the type of machine to run on
    runs-on: ubuntu-latest

    steps:
      # Checks out a copy of your repository on the ubuntu-latest machine
      - name: Checkout code
        uses: actions/checkout@v2

      # Runs the Super-Linter action
      - name: Run Super-Linter
        uses: github/super-linter@v3
        env:
          DEFAULT_BRANCH: main
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}


  build:

    runs-on: macOS-latest

    name: Build iPhone 12

    env:
      SCHEME: "GIthubActionTestProject"
      DEVICE: "iPhone 12"
      OS_VERSION: "14.2"

    steps:

    - name: Checkout project
      uses: actions/checkout@v1

    - name: CocoaPod Install
      run: pod install

    - name: Force Xcode 12
      run: sudo xcode-select -switch /Applications/Xcode_12.2.ap

    - name: Clean Build, Build
      run: |
        set -o pipefail && xcodebuild -scheme $SCHEME -destination "platform=iOS Simulator,name=$DEVICE,OS=$OS_VERSION" build-for-testing
        
  unit_test:
    
    runs-on: macOS-latest

    name: testing iPhone 12
    
    env:
      DEVICE: "iPhone 12"
      OS_VERSION: "14.2"
      UNIT_TEST_TARGET: "GIthubActionTestProjectTests"
          
    needs: build

    steps:

    - name: Checkout project
      uses: actions/checkout@v1

    - name: Run unit tests
      run: |
        set -o pipefail && xcodebuild test-without-building -scheme $UNIT_TEST_TARGET -project GIthubActionTestProject.xcodeproj -destination 'platform=iOS Simulator,name=$DEVICE,OS=$OS_VERSION'
